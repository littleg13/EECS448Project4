<!doctype html>

<html lang="en">
  <head>
    <title>Rendering Test</title>
    <script src="scripts/render.js"></script>
    <script>
var canvas;
var curPath;
var interval;
var previewPoints;
var quadCX;
var quadCY;
var quadX;
var quadY;
var arcX1;
var arcY1;
var arcX2;
var arcY2;
var arcR;
var lineX;
var lineY;
var startX;
var startY;
var bezCX1;
var bezCY1;
var bezCX2;
var bezCY2;
var bezX;
var bezY;

var main = () => {
  canvas = new Layer( "design", 500, 500 );
  canvas.attachToParent( document.getElementById("canvasdiv") )
  previewPoints = [];
  curPath = new Path( 250, 250, "green", "black" );
  linkInputs();
  interval = window.setInterval( loop, 100 );
}

var makeInput = ( id ) => {
  span = document.getElementById( id );
  let textbox = document.createElement("input");
  textbox.setAttribute("type", "text");
  textbox.value = span.innerHTML;
  span.parentElement.insertBefore( textbox, span );
}

var linkInputs = () => {
  quadCX = document.getElementById( "quadCX" );
  quadCY = document.getElementById( "quadCY" );
  quadX = document.getElementById( "quadX" );
  quadY = document.getElementById( "quadY" );
  arcX1 = document.getElementById( "arcX1" );
  arcY1 = document.getElementById( "arcY1" );
  arcX2 = document.getElementById( "arcX2" );
  arcY2 = document.getElementById( "arcY2" );
  arcR = document.getElementById( "arcR" );
  lineX = document.getElementById( "lineX" );
  lineY = document.getElementById( "lineY" );
  startX = document.getElementById( "startX" );
  startY = document.getElementById( "startY" );
  bezCX1 = document.getElementById( "bezCX1" );
  bezCY1 = document.getElementById( "bezCY1" );
  bezCX2 = document.getElementById( "bezCX2" );
  bezCY2 = document.getElementById( "bezCY2" );
  bezX = document.getElementById( "bezX" );
  bezY = document.getElementById( "bezY" );
}

var loop = () => {
  canvas.clear();
  canvas.drawItem( curPath );
  let x = curPath.initX;
  let y = curPath.initY;
  let segments = curPath.segments;
  let pathText = document.getElementById( "pathPrint" );
  pathText.innerHTML = "Starting point: (" + x + ", " + y + ")\n";
  segments.forEach( (segment) => {
    if( segment instanceof LineSegment ) {
      pathText.innerHTML += "Line: (" + segment.x + ", " + segment.y + ")\n";
    } else if( segment instanceof ArcSegment ) {

    } else if( segment instanceof QuadraticSegment ) {
      pathText.innerHTML += "Quadratic: Control (" + segment.cx + ", " + segment.cy + ") End (" + segment.x + ", " + segment.y + ")\n"
    } else if( segment instanceof BezierSegment ) {
      pathText.innerHTML += "Bezier: Control (" + segment.cx1 + ", " + segment.cy1 + ") Control (" + segment.cx2 + ", " + segment.cy2 + ") End (" + segment.x + ", " + segment.y + ")\n"
    }
  });
  canvas.drawItem( new Circle( x, y, 5, "black" ) );
  previewPoints.forEach( ( point ) => {
    canvas.drawItem( point );
  });
}

var changeMenu = () => {
  previewPoints = [];
  let divs = document.getElementById( "menus" ).getElementsByTagName( "div" );
  let id = document.getElementById( "menuSelect" ).value;
  for( let i = 0; i < divs.length; i++ ) {
    if( divs[i].getAttribute( "id" ) == id ) {
      divs[i].classList.remove("hidden");
      divs[i].classList.add("active");
    } else {
      divs[i].classList.remove("active");
      divs[i].classList.add("hidden");
    }
  }
}

var addLineSegment = () => {
  previewPoints = [];
  let x = lineX.value;
  let y = lineY.value;
  lineX.value = "";
  lineY.value = "";
  curPath.addSegment( new LineSegment( x, y ) );
}

var previewLineSegment = () => {
  previewPoints = [];
  let x = lineX.value;
  let y = lineY.value;
  previewPoints.push( new Circle( x, y, 5, "green" ) );
}

var addArcSegment = () => {
  previewPoints = [];
  let [ x1, y1, x2, y2, r ] = [ arcX1, arcY1, arcX2, arcY2, arcR ].map( ( input ) => {
    let val = input.value;
    input.value = "";
    return val;
  } );
  curPath.addSegment( new ArcSegment( x1, y1, x2, y2, r ) );
}

var previewArcSegment = () => {
  previewPoints = [];
  let [ x1, y1, x2, y2, r ] =
    [ arcX1, arcY1, arcX2, arcY2, arcR ].map( ( input ) => {
      return input.value;
    } );
  previewPoints.push( new Circle( x1, y1, 5, "red" ) );
  previewPoints.push( new Circle( x2, y2, 5, "red" ) );
}

var addQuadSegment = () => {
  previewPoints = [];
  let cx = quadCX.value;
  let cy = quadCY.value;
  let x = quadX.value;
  let y = quadY.value;
  quadCX.value = "";
  quadCY.value = "";
  quadX.value = "";
  quadY.value = "";
  curPath.addSegment( new QuadraticSegment( cx, cy, x, y ) );
}

var previewQuadSegment = () => {
  previewPoints = [];
  let cx = quadCX.value;
  let cy = quadCY.value;
  let x = quadX.value;
  let y = quadY.value;
  previewPoints.push( new Circle( cx, cy, 5, "red" ) );
  previewPoints.push( new Circle(  x,  y, 5, "green" ) );
}

var addBezSegment = () => {
  previewPoints = [];
  let inputs = [ bezCX1, bezCY1, bezCX2, bezCY2, bezX, bezY ];
  [ cx1, cy1, cx2, cy2, x, y ] = inputs.map( ( input ) => {
    let val = input.value;
    input.value = "";
    return val;
  });
  curPath.addSegment( new BezierSegment( cx1, cy1, cx2, cy2, x, y ) );
}

var previewBezSegment = () => {
  previewPoints = [];
  let inputs = [ bezCX1, bezCY1, bezCX2, bezCY2, bezX, bezY ];
  let vals = [ cx1, cy1, cx2, cy2, x, y ] = inputs.map( ( input ) => {
    return input.value;
  });
  previewPoints.push( new Circle( cx1, cy1, 5, "red" ) );
  previewPoints.push( new Circle( cx2, cy2, 5, "red" ) );
  previewPoints.push( new Circle( x, y, 5, "green" ) );
}

var moveStart = () => {
  previewPoints = [];
  let x = startX.value;
  let y = startY.value;
  startX.value = "";
  startY.value = "";
  curPath.initX = x;
  curPath.initY = y;
}

var previewMoveStart = () => {
  previewPoints = [];
  let x = startX.value;
  let y = startY.value;
  previewPoints.push( new Circle( x, y, 5, "red" ) );
}
    </script>
    <style>
    body {
      font-family: monospace;
    }
    canvas {
      border: 1px solid black;;
    }
    .hidden {
      display: none;
    }
    .active {
      display: block;
    }
    div#menus {
      text-align: left;
    }
    div#menus div {
      width: 50%;
      margin: 2em auto;
      padding: 0.5em;
      border: 1px solid black;
    }
    div#menus div input[type="button"] {
      float: right;
    }
    div#menus div label {
      display: inline-block;
      width: 6em;
    }
    textarea {
      float: right;
    }
    </style>
  </head>
  <body onload="main()">
    <textarea cols=75 rows=20 id="pathPrint">
    </textarea>
    <div id="canvasdiv">
    </div>
    <div id="menus">
      <select onchange="changeMenu()" id="menuSelect">
        <option value="moveStart">Move Start Point</option>
        <option value="lineSegment">Line Segment</option>
        <option value="arcSegment">Arc Segment</option>
        <option value="quadraticSegment">Quadratic Segment</option>
        <option value="bezierSegment">Bezier Segment</option>
      </select>
      <div id="moveStart" class="active">
        <span>Move starting point: </span><br>
        <label for="startX">X: </label>
        <input type="number" id="startX"><br>
        <label for="startY">Y: </label>
        <input type="number" id="startY">
        <input type="button" onclick="previewMoveStart()" value="preview">
        <input type="button" onclick="moveStart()" value="add">
      </div>
      <div id="lineSegment" class="hidden">
        <span>Add line segment: </span><br>
        <label for="lineX">X: </label>
        <input type="number" id="lineX"><br>
        <label for="lineY">Y: </label>
        <input type="number" id="lineY">
        <input type="button" onclick="previewLineSegment()" value="preview">
        <input type="button" onclick="addLineSegment()" value="add">
      </div>
      <div id="arcSegment" class="hidden">
        <span>Add arc segment: </span><br>
        <label for="arcX1">X1: </label>
        <input type="number" id="arcX1"><br>
        <label for="arcY1">Y1: </label>
        <input type="number" id="arcY1"><br>
        <label for="arcX2">X2: </label>
        <input type="number" id="arcX2"><br>
        <label for="arcY2">Y2: </label>
        <input type="number" id="arcY2"><br>
        <label for="arcR">R: </label>
        <input type="number" id="arcR">
        <input type="button" onclick="previewArcSegment()" value="preview">
        <input type="button" onclick="addArcSegment()" value="add">
      </div>
      <div id="quadraticSegment" class="hidden">
        <span>Add quadratic segment: </span><br>
        <label for="quadCX">Control X: </label>
        <input type="number" id="quadCX"><br>
        <label for="quadCY">Control Y: </label>
        <input type="number" id="quadCY"><br>
        <label for="quadX">End X: </label>
        <input type="number" id="quadX"><br>
        <label for="quadY">End Y: </label>
        <input type="number" id="quadY">
        <input type="button" onclick="previewQuadSegment()" value="preview">
        <input type="button" onclick="addQuadSegment()" value="add">
      </div>
      <div id="bezierSegment" class="hidden">
        <span>Add bezier segment: </span><br>
        <label for="bezCX1">Control X1: </label>
        <input type="number" id="bezCX1"><br>
        <label for="bezCY1">Control Y1: </label>
        <input type="number" id="bezCY1"><br>
        <label for="bezCX2">Control X2: </label>
        <input type="number" id="bezCX2"><br>
        <label for="bezCY2">Control Y2: </label>
        <input type="number" id="bezCY2"><br>
        <label for="bezX">End X: </label>
        <input type="number" id="bezX"><br>
        <label for="bezY">End Y: </label>
        <input type="number" id="bezY">
        <input type="button" onclick="previewBezSegment()" value="preview">
        <input type="button" onclick="addBezSegment()" value="add">
      </div>
    </div>
    <span id="test" onclick="makeInput('test')">Click me</span>
  </body>
</html>
