<!doctype html>

<html lang="en">
  <head>
    <title>Tanks</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="styles.css">
    <script src="scripts/socket.io.js"></script>
    <script src="scripts/render.js"></script>
    <script src="scripts/icons.js"></script>
    <script src="scripts/cards.js"></script>
    <script src="scripts/entity.js"></script>
    <script src="scripts/map.js"></script>
    <script src="scripts/game.js"></script>
    <script src="scripts/main.js" defer></script>
    <!-- <link
      rel="stylesheet"    href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    /> -->
    <script>
    const delay = 10;
    var resizeTaskId = null;

    var handleResize = ( evt ) => {
      if( game === null ) return;
      // 128 is subtracted to account for 4em margins, where 1em = 16px
      // height has additional adjustment for Exit button ( 1em margins, 1em padding, 1em text)
      let rect = { width : window.innerWidth - 128, height : window.innerHeight - 128 - 64 };
      if( rect.width < 600 || rect.height < 600 ) {
        game.curBoxDim = parseInt( Math.min( rect.width / game.mapDim, rect.height / game.mapDim ) );
        let canvasSize = game.curBoxDim * game.mapDim;
        game.gameview.resize( canvasSize, canvasSize );
        game.effects.resize( canvasSize, canvasSize );
        game.scale = game.curBoxDim / game.tileDim;
      } else {
        canvasSize = 600;
        game.gameview.resize( canvasSize, canvasSize );
        game.effects.resize( canvasSize, canvasSize );
        game.gridBoxDim = parseInt( canvasSize / game.mapDim );
        game.scale = game.curBoxDim / game.tileDim;
      }
    }

    window.addEventListener("resize", (evt) => {
      return;
      if( resizeTaskId !== null ) {
        clearTimeout( resizeTaskId );
      }

      resizeTaskId = setTimeout( () => {
        resizeTaskId = null;
        handleResize( evt );
      }, delay);
    });

    </script>
  </head>
  <body>
    <main id="wrapper">
      <h1 id="title">Welcome to tanks!</h1>
      <div id="splash">
        <label for="username">Enter a username:</label><br>
        <input type="text" id="username">
        <button type="button" onclick="pickUsername()">Enter Username</button>
      </div>

      <div id="splash2">
        <button type='button' onclick="enterMatchmaking()">Find a game</button>
        <button type='button' onclick="loadJoin()">Join a Lobby</button>
        <button type='button' onclick="createLobby()">Create a Lobby</button>
      </div>

      <div id="join">
        <label for="lobbyCode">Enter a room code:</label><br>
        <input type='text' id="lobbyCode"><br>
        <button type='button' onclick="joinLobby()">Join Lobby</button>
        <button type="button" onclick="makeActive('splash2')">Back</button>
      </div>

      <div id="waiting" class="active">
        <h1>Loading...</h1>
      </div>
      <div id="connect_error">
        <h1>Error Connecting...</h1>
        <p>It seems like we can't make a connection to the server!</p>
        <button type="button" onclick="reattemptConnect()" id="retry">Try to Reconnect</button>
      </div>

      <div id="lobbyMenu">
        <h3>Lobby Code: <span id="lobbyName"></span></h3>
        <h3>Players:</h3>
        <ul id="lobbyList">
        </ul>
        <button type="button" onclick="startGame()" id="startGame">Start Game</button>
        <button type="button" onclick="logout()">Logout</button>
      </div>
    </main>
    <div id="game">
      <div id="gameBody">
        <input type="checkbox" id="chatToggle" class="toggle" onchange="resetChatHeader()">
        <div class="sidebar" id="leftSide">
          <div class="container" id="chatWindow">
            <label for="chatToggle">
              <div id="chatHeader">Show Chat</div>
            </label>
            <div class="container" id="messageWindow"></div>
            <div id="chatBox">
              <input type="text" id="textBox"></input>
              <input type="submit" value="enter" onclick="sendMsg()">
            </div>
          </div>
        </div>
        <div id="center">
        </div>
        <div id="rightSide" class="sidebar">
          <div id="additionalInfo">
            <div id="userInfo">
              <div id="spin"><input type="range" min="-100" max="100" value="0" class="slider" id="spinSlider"></div>
            </div>
            <div id="lobbyInfo"></div>
          </div>
        </div>
      </div>
      <button type="button" onclick="logout()">Exit</button>
    </div>
    <div id="hidden"></div>
  </body>
</html>
